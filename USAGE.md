# Использование Road Detector Go API

## Команды Makefile

### База данных
```bash
make db-up       # Запустить PostgreSQL базу данных
make db-down     # Остановить базу данных  
make db-restart  # Перезапустить базу данных
make db-status   # Проверить статус базы данных
make db-setup    # Запустить БД и применить миграции
make logs        # Показать логи базы данных

# Миграции
make migrate     # Применить миграции базы данных
make migrate-up  # Применить миграции
make migrate-down# Откатить миграции
make migrate-reset# Сбросить БД и применить миграции заново
```

### Сборка и запуск
```bash
make build       # Собрать проект
make run         # Запустить сервер (автоматически соберет)
make dev         # Пересобрать и запустить сервер
make rebuild     # Полная пересборка проекта
```

### Утилиты
```bash
make clean       # Очистить собранные файлы
make test        # Запустить тесты
make help        # Показать все доступные команды
```

## Быстрый старт

1. **Запустить базу данных:**
   ```bash
   make db-up
   ```

2. **Запустить сервер:**
   ```bash
   make run
   ```

3. **Или все вместе:**
   ```bash
   make db-up && make run
   ```

## Полезные команды

### Проверить что все работает:
```bash
curl http://localhost:8080/api/v1/health
```

### Просмотреть логи базы данных:
```bash
make logs
```

### Остановить все:
```bash
make db-down
```

## Исправления

Версия с исправлениями включает:

1. ✅ **Исправлено сохранение видео** - видео файл читается один раз и используется повторно
2. ✅ **Исправлена формула расстояния** - используется точная формула Haversine
3. ✅ **Добавлено детальное логирование** - для диагностики проблем с сохранением
4. ✅ **Создан Makefile** - для удобного управления проектом
5. ✅ **Очищена база данных** - удалены конфликтующие записи

Теперь видео должно сохраняться корректно, а данные попадать в базу данных! 